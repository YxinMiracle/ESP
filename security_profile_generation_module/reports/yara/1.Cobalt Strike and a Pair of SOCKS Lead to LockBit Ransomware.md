# Cobalt Strike and a Pair of SOCKS Lead to LockBit Ransomware



> Source link: https://thedfirreport.com/2025/01/27/cobalt-strike-and-a-pair-of-socks-lead-to-lockbit-ransomware/
>
> Rewritten section: Discovery (check.exe)



- Rewritten content：

```text
Analysis of the attack reveals that threat actors deployed a malicious executable named check.exe in the C:\Users\Public\Music\ directory, with the SHA-256 hash 3F97E112F0C5DDF0255EF461746A223208DC0846BDE2A6DCA9C825D9C706A4E9. The file’s metadata indicates its original name was DiskCheck.exe, confirming it as a trojanized payload. Upon execution, check.exe generated multiple log files (computers.txt, LivePc.txt, DeadPc.txt) and leveraged PowerShell to query Active Directory, exporting details of all domain-enabled systems to AllWindows.csv. Subsequent actions included repeated launches of Task Manager (taskmgr) for system monitoring and manipulation of Group Policy settings via gpedit.msc. The presence of a folder named Lockbit, combined with these TTPs—particularly the AD reconnaissance and abuse of administrative tools—strongly correlates with LockBit ransomware operations, exhibiting hallmark behaviors of a ransomware attack.
```



- Manually written YARA rules

https://github.com/The-DFIR-Report/Yara-Rules/blob/main/27138/27138.yar （sig_27138_files_check ）

```yara
rule sig_27138_files_check {
   meta:
      description = "27138 - file check.exe"
      author = "The DFIR Report"
      reference = "https://thedfirreport.com/2025/01/27/cobalt-strike-and-a-pair-of-socks-lead-to-lockbit-ransomware/"
      date = "2025-01-23"
      hash1 = "3f97e112f0c5ddf0255ef461746a223208dc0846bde2a6dca9c825d9c706a4e9"
   strings:
      $x1 = "C:\\Users\\ad\\source\\repos\\ReadByte\\ReadByte\\obj\\Release\\DiskCheck.pdb" fullword ascii
      $s2 = "lSystem.Resources.ResourceReader, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089#System.Resources.R" ascii
      $s3 = "DiskCheck.exe" fullword wide
      $s4 = "computers.txt" fullword wide
      $s5 = "Error.txt" fullword wide
      $s6 = "SELECT * FROM Win32_LoggedOnUser" fullword wide
      $s7 = "Complete!!!" fullword wide
      $s8 = "LivePc.txt" fullword wide
      $s9 = "DeadPc.txt" fullword wide
      $s10 = "Success!!!" fullword wide
      $s11 = "vSphere!!!" fullword wide
      $s12 = "Synology" fullword wide
      $s13 = "Programs.csv" fullword wide
      $s14 = ".NETFramework,Version=v4.6.2" fullword ascii
      $s15 = ".NET Framework 4.6.2" fullword ascii
      $s16 = "ReadByte.Form1+<Disk>d__5" fullword ascii
      $s17 = "ReadRemoteRegistryusingWMI" fullword ascii
      $s18 = "diskSpace.csv" fullword wide
      $s19 = "ReadByte.Form1.resources" fullword ascii
      $s20 = "SELECT * FROM Win32_MappedLogicalDisk" fullword wide
   condition:
      uint16(0) == 0x5a4d and filesize < 60KB and
      1 of ($x*) and 4 of them
}
```



- ESP Rule

```
rule LockBit_Ransomware_Detection {
    meta:
        description = "Detects indicators associated with LockBit ransomware operations, including malicious executables and log files."
        reference = "ESP Intelligence"
        author = "ESP"
        date = "2025-01-01"
        hash1 = "3f97e112f0c5ddf0255ef461746a223208dc0846bde2a6dca9c825d9c706a4e9"
    strings:
        $file1 = "LivePc.txt"
        $file2 = "DiskCheck.exe"
        $file3 = "computers.txt"
        $file4 = "check.exe"
        $malware1 = "Lockbit"
        $malware2 = "LockBit"
        $file5 = "DeadPc.txt"
    condition:
        any of them
}
```

